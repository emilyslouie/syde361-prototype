<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>DV Option 1</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/25a68f228e.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script type="text/javascript" src="papaparse.min.js"></script>
  </head>
  <body>
    <main>
      <h1>DV Option 1</h1>
      <h2>What is sleep and why is it important?</h2>
      <p>
        Sleep is a mandatory state of rest designed to restore energy and
        wellbeing. Sleep is responsible for brain health through memory storage,
        clearing out toxins, and allowing the brain to recover from stress as
        well as body health, impacting growth, hormones, and the immune system
        [1][2][3]. It has been shown that not getting enough sleep at night can
        be detrimental to both physical and mental health, leading to higher
        risk of obesity, heart disease, and decreased focus [3]. Since sleep
        serves as the foundation for our wellbeing, it's important that we get a
        good night's sleep every night.
      </p>
      <h2>What are some factors that affect sleep?</h2>
      <p>
        Light is a major contributing factor to a complete sleep and well-rested
        person. One article states, “natural daylight…has previously been shown
        to…improve sleep quality… [and] each additional hour spent outdoors
        advanced sleep by ~30 min” [4]. However, “later exposure to light >10
        lux had more nocturnal awakenings” [4]. This means that any light
        greater than 10 lux (1 lumen/m2) while sleeping would cause worse
        sleeping conditions and therefore contribute to a shorter sleep duration
        and poorer sleep quality.
      </p>
      <p>
        Temperature and humidity are two other major contributing factors to
        one's sleep. A study on Turkish university students showed that room
        scents, including humidity, caused poorer sleep in 53.1% of participants
        [5]. In another study, it showed that 24.8 degrees celsius was the most
        comfortable temperature for participants, meaning that any large
        incremental differences above or below this temperature would cause a
        change in sleep [6].
      </p>
      <p style="margin-top: 36px; margin-bottom: 36px">
        To better understand the relationship between these environmental
        factors and sleep, a week of data collection was conducted.
        Environmental conditions including light, temperature, and humidity,
        were collected during one's sleep, as well as recording self-reported
        moods before and after rest, and overall sleep duration. The data that
        was collected for an individual is presented below.
      </p>
      <table>
        <tr>
          <th id="sunday-header">Sunday</th>
          <th id="monday-header">Monday</th>
          <th id="tuesday-header">Tuesday</th>
          <th id="wednesday-header">Wednesday</th>
          <th id="thursday-header">Thursday</th>
          <th id="friday-header">Friday</th>
          <th id="saturday-header">Saturday</th>
        </tr>
        <tr>
          <td id="sunday-cell"></td>
          <td id="monday-cell"></td>
          <td id="tuesday-cell"></td>
          <td id="wednesday-cell"></td>
          <td id="thursday-cell"></td>
          <td id="friday-cell"></td>
          <td id="saturday-cell"></td>
        </tr>
      </table>
      <div id="cards">
        <div id="sunday-card" class="info">
          <div class="sunday-triangle"></div>
          <div class="card">
            <h2>Sunday</h2>
            <p id="day1-temperature"></p>
            <p id="day1-humidity"></p>
            <p id="day1-light"></p>
            <p id="day1-humidex"></p>
            <p style="margin-top: 36px">
              Looking back at the night, the average temperature was 23.3°C, the
              average humidity was 50.6%, and the average humidex was 26.3°C
              throughout the night in the room. The brightness was an average of
              0.08145 lux and reached a high of 0.712 lux in the room. Any of
              these listed factors may have affected the overall night's sleep.
            </p>
          </div>
        </div>
        <div id="monday-card" class="info">
          <div class="monday-triangle"></div>
          <div class="card">
            <h2>Monday</h2>
            <p id="day2-temperature"></p>
            <p id="day2-humidity"></p>
            <p id="day2-light"></p>
            <p id="day2-humidex"></p>
            <p style="margin-top: 36px">
              Looking back at the night, the average temperature was 24.8°C, the
              average humidity was 47.3%, and the average humidex was 28.4°C
              throughout the night in the room. The brightness was an average of
              0.20968 lux and reached a high of 1.38 lux in the room. Any of
              these listed factors may have affected the overall night's sleep.
            </p>
          </div>
        </div>
        <div id="tuesday-card" class="info">
          <div class="tuesday-triangle"></div>
          <div class="card">
            <h2>Tuesday</h2>
            <p id="day3-temperature"></p>
            <p id="day3-humidity"></p>
            <p id="day3-light"></p>
            <p id="day3-humidex"></p>
            <p style="margin-top: 36px">
              Looking back at the night, the average temperature was 24.0°C, the
              average humidity was 47.7%, and the average humidex was 27.1°C
              throughout the night in the room. The brightness was an average of
              0.56875 lux and reached a high of 2.55 lux in the room. Any of
              these listed factors may have affected the overall night's sleep.
            </p>
          </div>
        </div>
        <div id="wednesday-card" class="info">
          <div class="wednesday-triangle"></div>
          <div class="card">
            <h2>Wednesday</h2>
            <p id="day4-temperature"></p>
            <p id="day4-humidity"></p>
            <p id="day4-light"></p>
            <p id="day4-humidex"></p>
            <p style="margin-top: 36px">
              Looking back at the night, the average temperature was 25.6°C, the
              average humidity was 51.3%, and the average humidex was 30.1°C
              throughout the night in the room. The brightness was an average of
              0.02125 lux and reached a high of 0.323 lux in the room. Any of
              these listed factors may have affected the overall night's sleep.
            </p>
          </div>
        </div>
        <div id="thursday-card" class="info">
          <div class="thursday-triangle"></div>
          <div class="card">
            <h2>Thursday</h2>
            <p id="day5-temperature"></p>
            <p id="day5-humidity"></p>
            <p id="day5-light"></p>
            <p id="day5-humidex"></p>
            <p style="margin-top: 36px">
              Looking back at the night, the average temperature was 22.7°C, the
              average humidity was 50.2%, and the average humidex was 25.4°C
              throughout the night in the room. The brightness was an average of
              0.06 lux and reached a high of 0.604 lux in the room. Any of these
              listed factors may have affected the overall night's sleep.
            </p>
          </div>
        </div>
        <div id="friday-card" class="info">
          <div class="friday-triangle"></div>
          <div class="card">
            <h2>Friday</h2>
            <p id="day6-temperature"></p>
            <p id="day6-humidity"></p>
            <p id="day6-light"></p>
            <p id="day6-humidex"></p>
            <p style="margin-top: 36px">
              Looking back at the night, the average temperature was 24.8°C, the
              average humidity was 48.7%, and the average humidex was 28.5°C
              throughout the night in the room. The brightness was an average of
              0.08448 lux and reached a high of 0.734 lux in the room. Any of
              these listed factors may have affected the overall night's sleep.
            </p>
          </div>
        </div>
        <div id="saturday-card" class="info">
          <div class="saturday-triangle"></div>
          <div class="card">
            <h2>Saturday</h2>
            <p id="day7-temperature"></p>
            <p id="day7-humidity"></p>
            <p id="day7-light"></p>
            <p id="day7-humidex"></p>
            <p style="margin-top: 36px">
              Looking back at the night, the average temperature was 22.9°C, the
              average humidity was 52.0%, and the average humidex was 25.8°C
              throughout the night in the room. The brightness was an average of
              0.1477 lux and reached a high of 1.07 lux in the room. Any of
              these listed factors may have affected the overall night's sleep.
            </p>
          </div>
        </div>
      </div>
      <h2 style="margin-top: 36px">References</h2>
      <p>
        [1] “How Sleep Clears the Brain.” NIH Research Matters. 28-Oct-2013.
        https://www.nih.gov/news-events/nih-research-matters/how-sleep-clears-brain.
        [Online]. (Accessed 08-July-2022).
      </p>
      <p>
        [2] “Sleep and your health.” MedlinePlus.
        https://medlineplus.gov/ency/patientinstructions/000871.htm. [Online].
        (Accessed 08-July-2022).
      </p>
      <p>
        [3] “The Benefits of Slumber: Why you need a good night's sleep.” News
        in Health. Apr-2013.
        https://newsinhealth.nih.gov/2013/04/benefits-slumber. [Online].
        (Accessed 08-July-2022).
      </p>
      <p>
        [4] C. Blume, C. Garbazza, M. Spitschan. “Effects of light on human
        circadian rhythm, sleep and mood.” National Library of Medicine. 2019.
        https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6751071/. [Online].
        (Accessed 05-July-2022).
      </p>
      <p>
        [5] I. Altun, N. Cinar, C. Dede. “The contributing factors to poor sleep
        experiences in according to the university students: A cross-sectional
        study.” National Library of Medicine.
        https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3634295/. [Online].
        (Accessed 05-July-2022).
      </p>
      <p>
        [6] X. Xu, Z. Lian, et. Al. “Environmental factors affecting sleep
        quality in summer: a field study in Shanghai, China.” ScienceDirect:
        Journal of Thermal Biology.
        https://www.sciencedirect.com/science/article/abs/pii/S0306456521001455.
        [Online]. (Accessed 05-July-2022).
      </p>
    </main>
  </body>
  <script type="text/javascript">
    const filesToParse = [
      "https://emily.louie.ca/syde361-data/Recording_1.csv",
      "https://emily.louie.ca/syde361-data/Recording_2.csv",
      "https://emily.louie.ca/syde361-data/Recording_3.csv",
      "https://emily.louie.ca/syde361-data/Recording_4.csv",
      "https://emily.louie.ca/syde361-data/Recording_5.csv",
      "https://emily.louie.ca/syde361-data/Recording_6.csv",
      "https://emily.louie.ca/syde361-data/Recording_7.csv",
      "https://emily.louie.ca/syde361-data/daily_mood_ratings.csv",
      // daily_mood_ratings.csv must be the last one
    ];

    const parseFiles = (files) => {
      const filesData = []; // Array to save file data
      Promise.all(
        // Parse each file
        [...files].map(
          (file) =>
            new Promise((resolve, reject) =>
              Papa.parse(file, {
                header: true,
                download: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: resolve, // Resolve each promise
                error: reject, // Reject if there is an error
              })
            )
        )
      )
        .then((results) => {
          results.forEach((result, index) => {
            // Save each file's data in a separate index
            filesData.push(result);
          });

          // process data and get charts
          generateChartContent(filesData);

          // process data and get daily moods
          generateDailyMoodsContent(filesData[filesData.length - 1].data);
        })
        .catch((err) => console.log("Something went wrong:", err));
    };

    // FUNCTIONS TO GET CHARTS

    const processDataForAverages = (data) => {
      let time = [];
      let light = [];
      let humidex = [];
      let humidity = [];
      let temperature = [];

      // add data to arrays so it can be used to calculate averages
      data.map((item) => {
        time.push(item.time);
        light.push(item["brightness (lux)"]);
        humidity.push(item["% humidity"]);
        temperature.push(item["temp (C)"]);
      });

      // convert humidity and temperature to humidex
      for (let i = 0; i < humidity.length; i++) {
        let humidityVal = humidity[i];
        let tempVal = temperature[i];
        let dewPointVal = calculateDewPoint(tempVal, humidityVal);
        let humidexVal = calculateHumidex(tempVal, dewPointVal);
        humidex.push(humidexVal);
      }

      // calculate averages for each type of data
      const avgLight = roundValueGivenLength(
        light.reduce((a, b) => a + b, 0) / light.length,
        5
      );
      const avgHumidex = roundValue(
        humidex.reduce((a, b) => a + b, 0) / humidex.length
      );
      const avgHumidity = roundValue(
        humidity.reduce((a, b) => a + b, 0) / humidity.length
      );
      const avgTemperature = roundValue(
        temperature.reduce((a, b) => a + b, 0) / temperature.length
      );

      return [
        avgLight,
        avgHumidex,
        avgHumidity,
        avgTemperature,
        ["light", "humidex", "humidity", "temperature"], // dataName
        [
          "Average light in lux: ",
          "Average humidex in °C: ",
          "Average relative humidity in %: ",
          "Average temperature in °C: ",
        ], // dataText
      ];
    };

    const renderAverages = (day, data, dataName, dataText) => {
      // Render average for dataName
      document.getElementById(
        `day${day}-${dataName}`
      ).textContent += `${dataText}${data}`;
    };

    const generateChartContent = (data) => {
      // For each day's worth of data, render charts
      for (let i = 0; i < data.length - 1; i++) {
        // format and process data
        const processedData = processDataForAverages(data[i].data);

        const dataNameIndex = 4;
        const dataTextIndex = 5;

        // iterate over each type of data
        for (let j = 0; j < processedData.length - 2; j++) {
          renderAverages(
            i + 1,
            processedData[j],
            processedData[dataNameIndex][j],
            processedData[dataTextIndex][j]
          );
        }
      }
    };

    // FUNCTIONS TO GET DAILY MOODS

    const toggleCard = (day) => {
      // Get all the cards and hide them
      let allCards = document.getElementById("cards");
      let childCards = allCards.children;

      for (let i = 0; i < childCards.length; i++) {
        let child = childCards[i];
        child.style.display = "none";
      }

      // Get the clicked on a card and show it
      let card = document.getElementById(`${day}-card`);
      if (card.style.display === "block") {
        card.style.display = "none";
      } else {
        card.style.display = "block";
      }

      // Get all the headers/cells and change the background to white
      let allHeaders = document.getElementsByTagName("th");
      let allCells = document.getElementsByTagName("td");

      for (let i = 0; i < allHeaders.length; i++) {
        let header = allHeaders[i];
        header.style.backgroundColor = "white";
        let cell = allCells[i];
        cell.style.backgroundColor = "white";
      }

      // Get the clicked on day and change background to yellow
      let header = document.getElementById(`${day}-header`);
      header.style.backgroundColor = "#FFED8D";
      let cell = document.getElementById(`${day}-cell`);
      cell.style.backgroundColor = "#FFED8D";
    };

    // Create HTML elements to render daily mood info
    const renderDailyMoods = (day, rating) => {
      // Render sleep ratings
      const ratingImgString = `<img class="rating" src="${getRatingImage(
        rating
      )}">`;
      document
        .getElementById(`${day}-cell`)
        .insertAdjacentHTML("beforeend", ratingImgString);

      // Render button to get day's info
      const linkString = `<button class="link-button" id="${day}-button">Learn more <i class="fa-solid fa-arrow-up-right-from-square"></i></button>`;

      document
        .getElementById(`${day}-cell`)
        .insertAdjacentHTML("beforeend", linkString);

      document.getElementById(`${day}-button`).onclick = function () {
        toggleCard(day);
      };
    };

    const generateDailyMoodsContent = (data) => {
      // Iterate over each day's worth of mood data which is every other row
      for (let i = 0; i < data.length - 1; i += 2) {
        // isolate start and end objects
        let end = data[i + 1];

        // declare variables to easily read data
        let endRating = end.rating;

        // calculate which day the data is for
        let day = i / 2 + 1;

        renderDailyMoods(getDayOfWeek(day), endRating);
      }
    };

    // HELPER FUNCTIONS

    // round to 1 decimal point
    const roundValue = (value) => {
      return Number(value.toFixed(1));
    };

    // round to any decimal point
    const roundValueGivenLength = (value, decimals) => {
      return Number(value.toFixed(decimals));
    };

    const calculateDewPoint = (tempVal, humidityVal) => {
      return tempVal - (100 - humidityVal) / 5;
    };

    const calculateHumidex = (tempVal, dewPointVal) => {
      return roundValue(
        tempVal +
          (5 / 9) *
            (6.11 *
              Math.exp(5417.753 * (1 / 273.16 - 1 / (273.15 + dewPointVal))) -
              10)
      );
    };

    const getRatingImage = (rating) => {
      if (rating === 1) {
        return "images/rating-1.png"; // mega sad face
      } else if (rating === 2) {
        return "images/rating-2.png"; // sad face
      } else if (rating === 3) {
        return "images/rating-3.png"; // ok face
      } else if (rating === 4) {
        return "images/rating-4.png"; // smiley face
      } else if (rating === 5) {
        return "images/rating-5.png"; // mega smiley face
      }
    };

    const getDayOfWeek = (day) => {
      if (day === 1) {
        return "sunday";
      } else if (day === 2) {
        return "monday";
      } else if (day === 3) {
        return "tuesday";
      } else if (day === 4) {
        return "wednesday";
      } else if (day === 5) {
        return "thursday";
      } else if (day === 6) {
        return "friday";
      } else if (day === 7) {
        return "saturday";
      }
    };

    parseFiles(filesToParse);
  </script>
</html>
